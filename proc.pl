#!/usr/bin/perl
use GD;

$im = new GD::Image(128,128);
$c=();

sub ac{
  my ($imin,$r,$g,$b,$l)=@_;
  my $m=(180/255,220/255,1,135/255)[$l];
  $r*=$m;
  $g*=$m;
  $b*=$m;
  return $imin->colorAllocate($r,$g,$b);
}

for($i=0;$i<3;$i++){
$c[1][$i]=ac($im,0, 0, 0,$i);
$c[1][$i]=ac($im,127, 178, 56,$i);
$c[2][$i]=ac($im,247, 233, 163,$i);
$c[3][$i]=ac($im,199, 199, 199,$i);
$c[4][$i]=ac($im,255, 0, 0,$i);
$c[5][$i]=ac($im,160, 160, 255,$i);
$c[6][$i]=ac($im,167, 167, 167,$i);
$c[7][$i]=ac($im,0, 124, 0,$i);
$c[8][$i]=ac($im,255, 255, 255,$i);
$c[9][$i]=ac($im,164, 168, 184,$i);
$c[10][$i]=ac($im,151, 109, 77,$i);
$c[11][$i]=ac($im,112, 112, 112,$i);
$c[12][$i]=ac($im,64, 64, 255,$i);
$c[13][$i]=ac($im,143, 119, 72,$i);
$c[14][$i]=ac($im,255, 252, 245,$i);
$c[15][$i]=ac($im,216, 127, 51,$i);
$c[16][$i]=ac($im,178, 76, 216,$i);
$c[17][$i]=ac($im,102, 153, 216,$i);
$c[18][$i]=ac($im,229, 229, 51,$i);
$c[19][$i]=ac($im,127, 204, 25,$i);
$c[20][$i]=ac($im,242, 127, 165,$i);
$c[21][$i]=ac($im,76, 76, 76,$i);
$c[22][$i]=ac($im,153, 153, 153,$i);
$c[23][$i]=ac($im,76, 127, 153,$i);
$c[24][$i]=ac($im,127, 63, 178,$i);
$c[25][$i]=ac($im,51, 76, 178,$i);
$c[26][$i]=ac($im,102, 76, 51,$i);
$c[27][$i]=ac($im,102, 127, 51,$i);
$c[28][$i]=ac($im,153, 51, 51,$i);
$c[29][$i]=ac($im,25, 25, 25,$i);
$c[30][$i]=ac($im,250, 238, 77,$i);
$c[31][$i]=ac($im,92, 219, 213,$i);
$c[32][$i]=ac($im,74, 128, 255,$i);
$c[33][$i]=ac($im,0, 217, 58,$i);
$c[34][$i]=ac($im,129, 86, 49,$i);
$c[35][$i]=ac($im,112, 2, 0,$i);
$c[36][$i]=ac($im,209, 177, 161,$i);
$c[37][$i]=ac($im,159, 82, 36,$i);
$c[38][$i]=ac($im,149, 87, 108,$i);
$c[39][$i]=ac($im,112, 108, 138,$i);
$c[40][$i]=ac($im,186, 133, 36,$i);
$c[41][$i]=ac($im,103, 117, 53,$i);
$c[42][$i]=ac($im,160, 77, 78,$i);
$c[43][$i]=ac($im,57, 41, 35,$i);
$c[44][$i]=ac($im,135, 107, 98,$i);
$c[45][$i]=ac($im,87, 92, 92,$i);
$c[46][$i]=ac($im,122, 73, 88,$i);
$c[47][$i]=ac($im,76, 62, 92,$i);
$c[48][$i]=ac($im,76, 50, 35,$i);
$c[49][$i]=ac($im,76, 82, 42,$i);
$c[50][$i]=ac($im,142, 60, 46,$i);
$c[51][$i]=ac($im,37, 22, 16,$i);
}

$fn=shift;

$data=`zcat $fn`;
$zerofound=0;

$p=index($data,'colors') + 6 + 4;

for($i=0;$i<128;$i++){
  for ($j=0;$j<128;$j++){
    $o=ord(substr($data,$p+$i*128+$j,1));
    $l=$o & 3;
    $o=$o>>2;
    $im->setPixel($j,$i,$c[$o][$l]);
  }
}
$pngdata = $im->png();

open $FH, ,">","mc.png" or die $@;
print $FH $pngdata;
close $FH;

print "Zero was found\n" if($zerofound);
